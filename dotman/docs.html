<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta
            name="description"
            content="Official documentation for Dotman. Learn how to install, configure, and manage your dotfiles efficiently with profiles and smart syncing."
        />
        
        <!-- Canonical URL -->
        <link rel="canonical" href="https://gabrielcapilla.github.io/dotman/docs.html" />

        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://gabrielcapilla.github.io/dotman/docs.html" />
        <meta property="og:title" content="Documentation | Dotman" />
        <meta property="og:description" content="Official documentation for Dotman. Learn how to install, configure, and manage your dotfiles efficiently with profiles and smart syncing." />
        <meta property="og:image" content="https://gabrielcapilla.github.io/dotman/assets/dotman-social-card.png" />

        <!-- Twitter -->
        <meta property="twitter:card" content="summary_large_image" />
        <meta property="twitter:url" content="https://gabrielcapilla.github.io/dotman/docs.html" />
        <meta property="twitter:title" content="Documentation | Dotman" />
        <meta property="twitter:description" content="Official documentation for Dotman. Learn how to install, configure, and manage your dotfiles efficiently with profiles and smart syncing." />
        <meta property="twitter:image" content="https://gabrielcapilla.github.io/dotman/assets/dotman-social-card.png" />

        <title>Documentation | dotman</title>
        
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        
        <!-- Optimized Font Loading: Preload + Swap -->
        <link 
            rel="preload" 
            as="style" 
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" 
        />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap"
            rel="stylesheet"
            media="print"
            onload="this.media='all'"
        />
        <noscript>
            <link
                href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap"
                rel="stylesheet"
            />
        </noscript>

        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
        <header>
            <div class="container header-inner">
                <a href="index.html" class="logo"> <span>~/</span>dotman </a>
                <nav class="nav-links">
                    <a href="index.html#features">Features</a>
                    <a href="index.html#install">Install</a>
                    <a href="docs.html" class="active">Docs</a>
                </nav>
            </div>
        </header>

        <div class="container">
            <div class="docs-wrapper">
                <aside>
                    <h4>Getting Started</h4>
                    <ul>
                        <li><a href="#introduction">Introduction</a></li>
                        <li><a href="#installation">Installation</a></li>
                        <li><a href="#quick-start">Quick Start</a></li>
                        <li>
                            <a href="#directory-structure"
                                >Directory Structure</a
                            >
                        </li>
                    </ul>

                    <h4>Core Concepts</h4>
                    <ul>
                        <li><a href="#categories">Categories</a></li>
                        <li><a href="#link-states">Link States</a></li>
                        <li><a href="#profiles">Profiles</a></li>
                        <li><a href="#validation">Validation</a></li>
                    </ul>

                    <h4>Commands</h4>
                    <ul>
                        <li>
                            <a href="#profile-commands">Profile Commands</a>
                        </li>
                        <li><a href="#manage-commands">Manage Commands</a></li>
                        <li><a href="#link-commands">Link Commands</a></li>
                        <li><a href="#status-commands">Status Commands</a></li>
                        <li><a href="#sync-commands">Sync Commands</a></li>
                    </ul>

                    <h4>Advanced</h4>
                    <ul>
                        <li><a href="#tips">Tips & Best Practices</a></li>
                        <li><a href="#examples">Examples</a></li>
                    </ul>
                </aside>

                <article>
                    <h1 id="introduction">Documentation</h1>
                    <p>
                        Welcome to the official documentation for
                        <strong>dotman</strong>. Dotman is a high-performance
                        dotfiles manager written in Nim.
                    </p>
                    <p>
                        Dotman features multi-profile support, automatic
                        conflict detection, and a zero-configuration approach.
                        It works seamlessly on Linux.
                    </p>

                    <h2 id="installation">Installation</h2>
                    <p>
                        Dotman is built with Nim and can be installed via
                        several methods.
                    </p>

                    <h3>Install the binary (fastest method)</h3>
                    <div class="code-block">
                        <code>
                            <span class="token-cmd">curl</span>
                            <span class="token-arg"
                                >-fsSL gabrielcapilla.github.io/install | bash
                                -s dotman</span
                            >
                        </code>
                    </div>

                    <h3>Install via Nimble</h3>
                    <p><strong>Requirements:</strong></p>
                    <ul>
                        <li>Nim 2.2.6 or later</li>
                    </ul>
                    <div class="code-block">
                        <code>
                            <span class="token-cmd">nimble</span>
                            <span class="token-arg"
                                >install
                                https://github.com/gabrielcapilla/dotman.git@#head</span
                            >
                        </code>
                    </div>

                    <h3>Install from Source</h3>
                    <p>Clone the repository and build the binary:</p>
                    <div class="code-block">
                        <code>
                            <span class="token-cmd">git</span>
                            <span class="token-arg"
                                >clone
                                https://github.com/gabrielcapilla/dotman.git</span
                            ><br /><br />
                            <span class="token-cmd">cd</span>
                            <span class="token-arg">dotman</span><br /><br />
                            <span class="token-cmd">nimble</span>
                            <span class="token-arg">build</span><br /><br />
                            <span class="token-cmd">nimble</span>
                            <span class="token-arg">install</span>
                        </code>
                    </div>

                    <h2 id="quick-start">Quick Start</h2>
                    <p>
                        Once installed, initialize dotman and start managing
                        your configuration files in minutes.
                    </p>

                    <div class="code-block">
                        <code>
                            <span class="token-comment"
                                ># Initialize dotman (creates
                                ~/.dotfiles/main)</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">init</span><br /><br />
                            <span class="token-comment"
                                ># Add your nvim config (moves file and creates
                                symlink)</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">set ~/.config/nvim</span
                            ><br /><br />
                            <span class="token-comment"
                                ># Check status of your configs</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">status</span>
                        </code>
                    </div>

                    <h2 id="directory-structure">Directory Structure</h2>
                    <p>
                        By default, dotman uses <code>~/.dotfiles</code> as the
                        root directory. The structure is organized by
                        <strong>categories</strong> that map to specific system
                        locations:
                    </p>

                    <div class="code-block">
                        <code>
                            <span class="shell-path">~/.dotfiles/</span><br />
                            └── <span class="shell-path">main/</span>
                            <span class="token-comment"># Default profile</span
                            ><br />
                            &nbsp;&nbsp;&nbsp;&nbsp;├──
                            <span class="shell-path">config/</span><br />
                            &nbsp;&nbsp;&nbsp;&nbsp;├──
                            <span class="shell-path">share/</span><br />
                            &nbsp;&nbsp;&nbsp;&nbsp;├──
                            <span class="shell-path">home/</span><br />
                            &nbsp;&nbsp;&nbsp;&nbsp;└──
                            <span class="shell-path">bin/</span><br />
                        </code>
                    </div>

                    <h2 id="categories">Categories</h2>
                    <p>
                        Dotman automatically categorizes files based on their
                        destination path. Each category maps to a specific
                        system location:
                    </p>

                    <div class="code-block">
                        <code>
                            <span class="shell-path">home/</span>
                            <span class="shell-operator">→</span> ~/<br />
                            <span class="shell-path">config/</span>
                            <span class="shell-operator">→</span>
                            ~/.config/<br />
                            <span class="shell-path">bin/</span>
                            <span class="shell-operator">→</span>
                            ~/.local/bin/<br />
                            <span class="shell-path">share/</span>
                            <span class="shell-operator">→</span>
                            ~/.local/share/<br />
                        </code>
                    </div>

                    <p>
                        When adding files, dotman automatically links them in
                        the correct path. For example:
                    </p>

                    <div class="code-block">
                        <code>
                            <span class="token-comment"
                                ># config/nvim → ~/.config/nvim</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">add nvim</span><br /><br />
                            <span class="token-comment"
                                ># share/fonts → ~/.local/share/fonts</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">add fonts</span>
                        </code>
                    </div>

                    <h2 id="link-states">Link States</h2>
                    <p>
                        The <code>status</code> command shows the state of each
                        file in your profiles:
                    </p>

                    <ul>
                        <li>
                            <strong>Linked</strong> - The file is properly
                            symlinked from the profile to the system
                        </li>
                        <li>
                            <strong>NotLinked</strong> - The file exists in the
                            profile but is not symlinked
                        </li>
                        <li>
                            <strong>Conflict</strong> - A file exists at the
                            target location but is not managed by dotman
                        </li>
                        <li>
                            <strong>OtherProfile</strong> - The file is linked
                            to another profile
                        </li>
                    </ul>

                    <h2 id="profiles">Profiles</h2>
                    <p>
                        Profiles allow you to manage different configurations
                        for different environments (e.g.,
                        <code>experimental</code>, <code>laptop</code>,
                        <code>main</code>). The <code>main</code> profile is
                        created by default and cannot be deleted.
                    </p>

                    <div class="code-block">
                        <code>
                            <span class="token-comment"
                                ># Create a new profile</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">make experimental</span
                            ><br /><br />
                            <span class="token-comment"
                                ># Clone an existing profile</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">clone main laptop</span
                            ><br /><br />
                            <span class="token-comment"
                                ># List all profiles</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">list</span><br /><br />
                            <span class="token-comment"># Delete a profile</span
                            ><br />
                            <span class="token-comment"
                                ># Note: `main` profile cannot be deleted</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg"
                                >--delete-profile experimental</span
                            >
                        </code>
                    </div>

                    <h2 id="validation">Validation</h2>
                    <p>
                        Dotman automatically validates symlinks before creating
                        them to prevent conflicts and data loss:
                    </p>

                    <ul>
                        <li>
                            Checks for existing files at the target location
                        </li>
                        <li>Detects conflicts with other profiles</li>
                        <li>Validates directory structure</li>
                        <li>Reports broken or orphaned symlinks</li>
                    </ul>

                    <h2 id="profile-commands">Profile Commands</h2>

                    <h3>init</h3>
                    <p>
                        Initialize dotman directory structure in
                        <code>~/.dotfiles</code>.
                    </p>
                    <div class="code-block">
                        <code>
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">init</span><br />
                            <span class="token-comment"># or using alias</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">-i</span>
                        </code>
                    </div>

                    <h3>make</h3>
                    <p>Create a new profile with the specified name.</p>
                    <div class="code-block">
                        <code>
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">make &lt;name&gt;</span
                            ><br />
                            <span class="token-comment"># or using alias</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">-m &lt;name&gt;</span>
                        </code>
                    </div>

                    <h3>clone</h3>
                    <p>Clone an existing profile to create a new one.</p>
                    <div class="code-block">
                        <code>
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg"
                                >clone &lt;source&gt; &lt;destination&gt;</span
                            ><br />
                            <span class="token-comment"># or using alias</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg"
                                >-c &lt;source&gt; &lt;destination&gt;</span
                            >
                        </code>
                    </div>

                    <h3>list</h3>
                    <p>List all available profiles.</p>
                    <div class="code-block">
                        <code>
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">list</span><br />
                            <span class="token-comment"># or using alias</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">-l</span>
                        </code>
                    </div>

                    <h2 id="manage-commands">Manage Commands</h2>

                    <h3>set</h3>
                    <p>
                        Move a file or directory from the system to the current
                        profile and create a symlink in its place. Use this when
                        you want to start managing an existing configuration
                        file.
                    </p>
                    <div class="code-block">
                        <code>
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">set &lt;file&gt;</span
                            ><br />
                            <span class="token-comment"># or using alias</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">-s &lt;file&gt;</span>
                        </code>
                    </div>

                    <p>
                        <strong>set vs add:</strong> Use <code>set</code> to
                        move existing files from your system into dotman
                        management. Use <code>add</code> when files already
                        exist in the profile and you just want to create
                        symlinks.
                    </p>

                    <h3>unset</h3>
                    <p>
                        Remove a symlink and restore the original file or
                        directory from the profile back to its system location.
                        This is the reverse operation of <code>set</code>.
                    </p>
                    <div class="code-block">
                        <code>
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">unset &lt;file&gt;</span
                            ><br />
                            <span class="token-comment"># or using alias</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">-u &lt;file&gt;</span>
                        </code>
                    </div>

                    <h2 id="link-commands">Link Commands</h2>

                    <h3>add</h3>
                    <p>
                        Create a symlink from the profile to the system. The
                        file must exist in the profile directory. Unlike
                        <code>set</code>, this command does not move files from
                        the system—it only creates symlinks.
                    </p>
                    <div class="code-block">
                        <code>
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">add &lt;file&gt;</span
                            ><br />
                            <span class="token-comment"># or using alias</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">-a &lt;file&gt;</span>
                        </code>
                    </div>

                    <h3>remove</h3>
                    <p>Remove a symlink from the profile.</p>
                    <div class="code-block">
                        <code>
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">remove &lt;file&gt;</span
                            ><br />
                            <span class="token-comment"># or using alias</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">-r &lt;file&gt;</span>
                        </code>
                    </div>

                    <h2 id="status-commands">Status Commands</h2>

                    <h3>status</h3>
                    <p>
                        Display the status of all files in the current main
                        profile.
                    </p>
                    <div class="code-block">
                        <code>
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">status</span>
                        </code>
                    </div>

                    <p><strong>Options:</strong></p>
                    <ul>
                        <li>
                            <code>--category &lt;cat&gt;</code> - Filter by
                            category (config, share, home, local, bin)
                        </li>
                        <li><code>--linked</code> - Show only linked files</li>
                        <li>
                            <code>--not-linked</code> - Show only unlinked files
                        </li>
                        <li>
                            <code>--conflicts</code> - Show only conflicting
                            files
                        </li>
                        <li><code>--other</code> - Show other profile files</li>
                        <li>
                            <code>--verbose, -v</code> - Show detailed
                            information
                        </li>
                        <li>
                            <code>--profile &lt;name&gt;</code> - Use specific
                            profile
                        </li>
                        <li>
                            <code>--ascii</code> - Use ASCII characters in table
                        </li>
                    </ul>

                    <p><strong>Examples:</strong></p>
                    <div class="code-block">
                        <code>
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg"
                                >status --category config</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg"
                                >status --linked --verbose</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">status --conflicts</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg"
                                >status --profile work --ascii</span
                            >
                        </code>
                    </div>

                    <h2 id="sync-commands">Sync Commands</h2>

                    <h3>push</h3>
                    <p>
                        Link all files from the profile to the system. Use it
                        when you want to apply all of your profile settings.
                        Similar to the <code>add</code> command but in bulk.
                    </p>
                    <div class="code-block">
                        <code>
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">push &lt;profile&gt;</span>
                        </code>
                    </div>

                    <h3>pull</h3>
                    <p>Remove all symbolic links from the selected profile.</p>
                    <div class="code-block">
                        <code>
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">pull &lt;profile&gt;</span>
                        </code>
                    </div>

                    <h2 id="global-options">Global Options</h2>

                    <ul>
                        <li>
                            <code>--profile &lt;name&gt;</code> - Select the
                            profile
                        </li>
                        <li>
                            <code>--delete-profile &lt;name&gt;</code> - Delete
                            a profile
                        </li>
                        <li><code>--help, -h</code> - Show help message</li>
                        <li>
                            <code>--version, -v</code> - Show version
                            information
                        </li>
                    </ul>

                    <h2 id="tips">Tips & Best Practices</h2>

                    <h3>Use Git with Dotman</h3>
                    <p>
                        Version control your dotfiles with Git by initializing a
                        repository in <code>~/.dotfiles</code>:
                    </p>
                    <div class="code-block">
                        <code>
                            <span class="token-cmd">cd</span>
                            <span class="token-arg">~/.dotfiles</span><br />
                            <span class="token-cmd">git</span>
                            <span class="token-arg">init</span><br />
                            <span class="token-cmd">git</span>
                            <span class="token-arg">add .</span><br />
                            <span class="token-cmd">git</span>
                            <span class="token-arg"
                                >commit -m "Initial commit"</span
                            >
                        </code>
                    </div>

                    <h3>Handle Conflicts</h3>
                    <p>
                        If dotman detects a conflict (a file exists at the
                        target location that isn't managed by dotman), it will
                        report it in the status. Resolve conflicts by:
                    </p>
                    <ul>
                        <li>
                            Moving or deleting the conflicting file manually
                        </li>
                        <li>
                            Using <code>--conflicts</code> flag to identify
                            issues
                        </li>
                        <li>
                            Checking which profile manages the file with
                            <code>--other</code> flag
                        </li>
                    </ul>

                    <h3>Profile Organization</h3>
                    <p>Keep your profiles organized by environment:</p>
                    <ul>
                        <li>
                            <code>main</code> - Common configurations used
                            across all machines
                        </li>
                        <li>
                            <code>experimental</code> - Test new configurations
                            without breaking your main setup
                        </li>
                        <li>
                            <code>laptop</code> - Your laptop has different
                            hardware; your configuration is different from the
                            main one
                        </li>
                    </ul>

                    <h3>Push/Pull Workflows</h3>
                    <p>
                        Using the <code>push</code> and <code>pull</code>
                        commands allows you to quickly switch between different
                        configurations.
                    </p>
                    <p>
                        Imagine you are testing an experimental configuration.
                    </p>
                    <div class="code-block">
                        <code>
                            <span class="token-comment"
                                ># Clone your main profile and create an
                                experimental profile</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg"
                                >clone main experimental</span
                            ><br /><br />
                            <span class="token-comment"
                                ># Remove all symbolic links from the main
                                profile</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">pull main</span><br /><br />
                            <span class="token-comment"
                                ># Link all files from the experimental profile
                                to the system</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">push experimental</span>
                        </code>
                    </div>
                    <p>
                        Now, you can modify and test new configurations without
                        affecting your main profile's configuration.
                    </p>

                    <h2 id="examples">Examples</h2>

                    <h3>Neovim Configuration</h3>
                    <p>Manage your Neovim setup across multiple machines:</p>
                    <div class="code-block">
                        <code>
                            <span class="token-comment"
                                ># Move nvim config to profile and link it</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">set ~/.config/nvim</span
                            ><br /><br />
                            <span class="token-comment"
                                ># Check status of config category</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg"
                                >status --category config</span
                            ><br /><br />
                            <span class="token-comment"
                                ># View detailed breakdown by subdirectory</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">status --verbose</span>
                        </code>
                    </div>

                    <h3>Theme Management</h3>
                    <p>Sync your themes across multiple machines:</p>
                    <div class="code-block">
                        <code>
                            <span class="token-comment"
                                ># Add color-schemes directory to profile</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg"
                                >set ~/.local/share/color-schemes</span
                            ><br /><br />
                            <span class="token-comment"
                                ># Check status with filters</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg"
                                >status --category share --linked</span
                            ><br /><br />
                            <span class="token-comment"
                                ># Check for any conflicts</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">status --conflicts</span>
                        </code>
                    </div>

                    <h3>Multi-Profile Workflow</h3>
                    <p>
                        Manage separate configurations for different
                        environments:
                    </p>
                    <div class="code-block">
                        <code>
                            <span class="token-comment"
                                ># Create profiles for different
                                environments</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">make exp</span><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">make laptop</span
                            ><br /><br />
                            <span class="token-comment"
                                ># Add experimental-specific config to
                                experimental profile</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg"
                                >--profile exp set ~/.config/alacritty</span
                            ><br /><br />
                            <span class="token-comment"
                                ># List all profiles</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">list</span><br /><br />
                            <span class="token-comment"
                                ># Check experimental profile status</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">status --profile exp</span
                            ><br /><br />
                            <span class="token-comment"
                                ># Remove a symlink and restore the original
                                file or directory</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg"
                                >--profile exp unset alacritty</span
                            ><br /><br />
                            <span class="token-comment"
                                ># Delete a profile (main cannot be
                                deleted)</span
                            ><br />
                            <span class="token-cmd">dotman</span>
                            <span class="token-arg">--delete-profile exp</span>
                        </code>
                    </div>
                </article>
            </div>
        </div>

        <footer class="docs-footer">
            <div class="container">
                <p>&copy; 2026 Dotman CLI. Open Source under MIT License.</p>
            </div>
        </footer>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const codeBlocks = document.querySelectorAll(".code-block");

                codeBlocks.forEach((block) => {
                    const code = block.querySelector("code");
                    if (!code) return;

                    const rawHTML = code.innerHTML;
                    const lines = rawHTML.split(/<br\s*\/?>/i);
                    const lineWrappers = [];

                    lines.forEach((line) => {
                        const trimmed = line.trim();
                        if (!trimmed) return;

                        const div = document.createElement("div");
                        div.className = "code-line";
                        div.innerHTML = trimmed;

                        const tempDiv = document.createElement("div");
                        tempDiv.innerHTML = trimmed;

                        // Intelligent extraction: Remove comments
                        const comments = tempDiv.querySelectorAll(
                            ".token-comment, .shell-comment",
                        );
                        comments.forEach((c) => c.remove());

                        // Get text content (includes text nodes between spans)
                        let commandText = tempDiv.textContent || "";
                        // Normalize whitespace
                        commandText = commandText.replace(/\s+/g, " ").trim();

                        div.dataset.command = commandText;

                        if (!commandText) {
                            div.classList.add("non-copyable");
                        } else {
                            div.title = "Click to copy this command";
                        }

                        lineWrappers.push(div);
                    });

                    if (lineWrappers.length > 0) {
                        code.innerHTML = "";
                        lineWrappers.forEach((wrapper) => {
                            code.appendChild(wrapper);
                        });

                        block.addEventListener("click", function (e) {
                            const targetLine = e.target.closest(".code-line");

                            // If clicked on a specific line
                            if (targetLine) {
                                if (
                                    targetLine.classList.contains(
                                        "non-copyable",
                                    )
                                ) {
                                    return; // Do nothing for comments
                                }
                                const commandText =
                                    targetLine.dataset.command || "";
                                if (commandText) {
                                    copyToClipboard(commandText);
                                }
                            } else {
                                // If clicked on the block padding (copy all executable commands)
                                const allCommands = Array.from(
                                    code.querySelectorAll(".code-line"),
                                )
                                    .map(
                                        (wrapper) =>
                                            wrapper.dataset.command || "",
                                    )
                                    .filter((text) => text)
                                    .join("\n");
                                if (allCommands) {
                                    copyToClipboard(allCommands);
                                }
                            }
                        });

                        const hasCopyable = lineWrappers.some(
                            (l) => !l.classList.contains("non-copyable"),
                        );
                        if (hasCopyable) {
                            block.title =
                                "Click to copy all commands, or click a line to copy just that command";
                            block.style.cursor = "pointer";
                        } else {
                            block.style.cursor = "default";
                        }
                    }
                });

                async function copyToClipboard(text) {
                    if (!text) return;
                    try {
                        await navigator.clipboard.writeText(text);
                        const display =
                            text.length > 30
                                ? text.substring(0, 30) + "..."
                                : text;
                        showToast("Copied: " + display);
                    } catch (err) {
                        console.error("Failed to copy:", err);
                    }
                }

                function showToast(message) {
                    const existingToast = document.querySelector(".toast");
                    if (existingToast) {
                        existingToast.remove();
                    }

                    const toast = document.createElement("div");
                    toast.className = "toast";
                    toast.textContent = message;
                    document.body.appendChild(toast);

                    setTimeout(() => {
                        toast.style.opacity = "1";
                    }, 10);

                    setTimeout(() => {
                        toast.style.opacity = "0";
                        setTimeout(() => toast.remove(), 300);
                    }, 2000);
                }
            });
        </script>
    </body>
</html>
